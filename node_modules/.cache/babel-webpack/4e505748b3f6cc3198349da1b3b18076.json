{"ast":null,"code":"import { FormGroup, Validators } from \"@angular/forms\";\nimport { Subject } from \"rxjs\";\nimport { takeUntil } from \"rxjs/operators\";\nimport { FORM_RESET_EVENT_KEY, RATINGS } from \"../content.model\";\nimport { AddFacade } from \"./add.facade\";\nimport { addArtStorage } from \"./addArt.storage.service\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./add.facade\";\nimport * as i2 from \"src/app/services\";\nimport * as i3 from \"@angular/forms\";\nimport * as i4 from \"src/app/services/event.buss.service\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"./character.directive\";\nimport * as i7 from \"@ngx-translate/core\";\n\nfunction AddComponent_div_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 14);\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"translate\");\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(2, 1, \"errors.ENTER_ART_NAME\"), \" \");\n  }\n}\n\nfunction AddComponent_span_18_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"span\", 15);\n    i0.ɵɵlistener(\"click\", function AddComponent_span_18_Template_span_click_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r5);\n      const name_r3 = restoredCtx.$implicit;\n      const ctx_r4 = i0.ɵɵnextContext();\n      return ctx_r4.fetchArt(name_r3);\n    });\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const name_r3 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(name_r3);\n  }\n}\n\nfunction AddComponent_div_19_div_6_span_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 29);\n    i0.ɵɵelement(1, \"input\", 30);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const rating_r10 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"value\", rating_r10);\n  }\n}\n\nfunction AddComponent_div_19_div_6_ng_container_16_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 33);\n    i0.ɵɵtext(1, \" \\u10E0\\u10D4\\u10D5\\u10D8\\u10E3 \\u10E1\\u10D0\\u10D5\\u10D0\\u10DA\\u10D3\\u10D4\\u10D1\\u10E3\\u10DA\\u10DD\\u10D0 \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction AddComponent_div_19_div_6_ng_container_16_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 33);\n    i0.ɵɵtext(1, \" \\u10D2\\u10D0\\u10DC\\u10EE\\u10D8\\u10DA\\u10D5\\u10D0 \\u10E3\\u10DC\\u10D3\\u10D0 \\u10D8\\u10E7\\u10DD\\u10E1 \\u10DB\\u10D8\\u10DC\\u10D8\\u10DB\\u10E3\\u10DB 10 \\u10E1\\u10D8\\u10DB\\u10D1\\u10DD\\u10DA\\u10DD \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction AddComponent_div_19_div_6_ng_container_16_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0, 31);\n    i0.ɵɵtemplate(1, AddComponent_div_19_div_6_ng_container_16_div_1_Template, 2, 0, \"div\", 32);\n    i0.ɵɵtemplate(2, AddComponent_div_19_div_6_ng_container_16_div_2_Template, 2, 0, \"div\", 32);\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r9 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r9.form.controls.review == null ? null : ctx_r9.form.controls.review.errors == null ? null : ctx_r9.form.controls.review.errors.required);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r9.form.controls.review == null ? null : ctx_r9.form.controls.review.errors == null ? null : ctx_r9.form.controls.review.errors.minlength);\n  }\n}\n\nfunction AddComponent_div_19_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r15 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 18);\n    i0.ɵɵelementStart(1, \"form\", 19);\n    i0.ɵɵlistener(\"submit\", function AddComponent_div_19_div_6_Template_form_submit_1_listener() {\n      i0.ɵɵrestoreView(_r15);\n      const selectedArt_r6 = i0.ɵɵnextContext().ngIf;\n      const ctx_r13 = i0.ɵɵnextContext();\n      return ctx_r13.submit(selectedArt_r6);\n    });\n    i0.ɵɵelementStart(2, \"div\", 20);\n    i0.ɵɵelementStart(3, \"label\", 21);\n    i0.ɵɵtext(4, \"Review\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"div\", 22);\n    i0.ɵɵelement(6, \"textarea\", 23);\n    i0.ɵɵelementStart(7, \"span\", 24);\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"div\", 20);\n    i0.ɵɵelementStart(10, \"label\", 25);\n    i0.ɵɵtext(11, \"Rating\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"div\", 22);\n    i0.ɵɵtemplate(13, AddComponent_div_19_div_6_span_13_Template, 2, 1, \"span\", 26);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"button\", 27);\n    i0.ɵɵtext(15, \"Add\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(16, AddComponent_div_19_div_6_ng_container_16_Template, 3, 2, \"ng-container\", 28);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r7 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"formGroup\", ctx_r7.form);\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"length\", ctx_r7.form.controls.review == null ? null : ctx_r7.form.controls.review.value.length);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" Characters:\", ctx_r7.form.controls.review == null ? null : ctx_r7.form.controls.review.value.length, \"\");\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r7.ratings);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", ctx_r7.submitted);\n  }\n}\n\nfunction AddComponent_div_19_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelement(1, \"img\", 16);\n    i0.ɵɵelementStart(2, \"h3\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"h3\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(6, AddComponent_div_19_div_6_Template, 17, 5, \"div\", 17);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const selectedArt_r6 = ctx.ngIf;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"src\", selectedArt_r6.imageUrl, i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(selectedArt_r6.title);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(selectedArt_r6.artistBio);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", selectedArt_r6);\n  }\n}\n\nexport let AddComponent = /*#__PURE__*/(() => {\n  class AddComponent {\n    constructor(facade, auth, formBuilder, eventBus) {\n      this.facade = facade;\n      this.auth = auth;\n      this.formBuilder = formBuilder;\n      this.eventBus = eventBus;\n      this.unsubscribe$ = new Subject();\n      this.form = new FormGroup({});\n      this.searchKey = \"\";\n      this.selectedArt$ = null;\n      this.searchHasError = false;\n      this.submitted = false;\n    }\n\n    get lastThreeSearches() {\n      return this.facade.lastThreeSearches;\n    }\n\n    get ratings() {\n      return RATINGS;\n    }\n\n    search() {\n      if (!this.searchKey) {\n        this.searchHasError = true;\n        return;\n      }\n\n      this.searchHasError = false;\n      this.facade.addToLastThreeSearches(this.searchKey);\n      this.fetchArt(this.searchKey);\n    }\n\n    fetchArt(title) {\n      this.selectedArt$ = this.facade.fetchArt(title);\n    }\n\n    buildForm() {\n      // this.form = new FormGroup({\n      //   review: new FormControl(\"\", [\n      //     Validators.required,\n      //     Validators.minLength(10),\n      //   ]),\n      //   rating: new FormControl(1),\n      // });\n      this.form = this.formBuilder.group({\n        review: [\"\", [Validators.required, Validators.minLength(10)]],\n        rating: 1\n      });\n    }\n\n    submit(selectedArt) {\n      this.submitted = true;\n\n      if (this.form.invalid) {\n        return;\n      }\n\n      const value = this.form.value;\n      console.log(selectedArt);\n      const body = {\n        objectIds: selectedArt.objectID,\n        uid: this.auth.userId,\n        rating: value.rating,\n        review: value.review\n      };\n      console.log(body);\n      this.facade.submit(body);\n    }\n\n    formReset() {\n      var _a, _b;\n\n      this.form.reset();\n      this.form.updateValueAndValidity();\n      this.submitted = false;\n      (_a = this.form.get(\"review\")) === null || _a === void 0 ? void 0 : _a.setValue(\"\");\n      (_b = this.form.get(\"rating\")) === null || _b === void 0 ? void 0 : _b.setValue(1);\n    }\n\n    ngOnInit() {\n      this.buildForm();\n      this.facade.restoreState();\n      this.eventBus.on(FORM_RESET_EVENT_KEY).pipe(takeUntil(this.unsubscribe$)).subscribe(() => this.formReset());\n    }\n\n  }\n\n  AddComponent.ɵfac = function AddComponent_Factory(t) {\n    return new (t || AddComponent)(i0.ɵɵdirectiveInject(i1.AddFacade), i0.ɵɵdirectiveInject(i2.AuthService), i0.ɵɵdirectiveInject(i3.FormBuilder), i0.ɵɵdirectiveInject(i4.EventBusService));\n  };\n\n  AddComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: AddComponent,\n    selectors: [[\"app-add\"]],\n    features: [i0.ɵɵProvidersFeature([AddFacade, addArtStorage])],\n    decls: 21,\n    vars: 15,\n    consts: [[1, \"py-3\", \"text-center\", \"middle\"], [1, \"col-lg-6\", \"col-md-8\", \"mx-auto\"], [1, \"fw-light\", \"text-white\"], [1, \"py-5\"], [1, \"container\", \"d-flex\", \"justify-content-center\", \"flex-column\", \"w-100\"], [1, \"row\", \"d-flex\", \"justify-content-center\"], [1, \"search-form\", \"d-flex\", \"justify-content-center\", \"flex-column\"], [\"type\", \"text\", 1, \"form-control\", 3, \"ngModel\", \"placeholder\", \"ngModelChange\"], [1, \"btn\", \"btn-outline-secondary\", \"mt-2\", 3, \"click\"], [\"class\", \"alert alert-danger mt-2\", \"role\", \"alert\", 4, \"ngIf\"], [1, \"row\", \"d-flex\", \"justify-content-center\", \"mt-2\", \"flex-row\", \"mb-3\"], [1, \"d-flex\", \"justify-content-center\"], [\"class\", \"badge rounded-pill bg-success ms-1\", 3, \"click\", 4, \"ngFor\", \"ngForOf\"], [4, \"ngIf\"], [\"role\", \"alert\", 1, \"alert\", \"alert-danger\", \"mt-2\"], [1, \"badge\", \"rounded-pill\", \"bg-success\", \"ms-1\", 3, \"click\"], [3, \"src\"], [\"class\", \"row mt-3\", 4, \"ngIf\"], [1, \"row\", \"mt-3\"], [3, \"formGroup\", \"submit\"], [1, \"row\", \"mb-3\"], [\"for\", \"review\", 1, \"col-sm-2\", \"col-form-label\"], [1, \"col-sm-10\"], [\"formControlName\", \"review\", \"type\", \"email\", \"id\", \"review\", 1, \"form-control\"], [\"appCharacter\", \"\", 3, \"length\"], [\"for\", \"rating\", 1, \"col-sm-2\", \"col-form-label\"], [\"class\", \"ms-2\", 4, \"ngFor\", \"ngForOf\"], [\"type\", \"submit\", 1, \"btn\", \"btn-primary\"], [\"&&\", \"\", \"form.invalid\", \"\", 4, \"ngIf\"], [1, \"ms-2\"], [\"type\", \"radio\", \"formControlName\", \"rating\", 1, \"form-check-input\", 3, \"value\"], [\"&&\", \"\", \"form.invalid\", \"\"], [\"class\", \"alert alert-danger mt2\", \"role\", \"alert\", 4, \"ngIf\"], [\"role\", \"alert\", 1, \"alert\", \"alert-danger\", \"mt2\"]],\n    template: function AddComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"main\");\n        i0.ɵɵelementStart(1, \"section\", 0);\n        i0.ɵɵelementStart(2, \"div\", 1);\n        i0.ɵɵelementStart(3, \"h1\", 2);\n        i0.ɵɵtext(4);\n        i0.ɵɵpipe(5, \"translate\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(6, \"div\", 3);\n        i0.ɵɵelementStart(7, \"div\", 4);\n        i0.ɵɵelementStart(8, \"div\", 5);\n        i0.ɵɵelementStart(9, \"div\", 6);\n        i0.ɵɵelementStart(10, \"input\", 7);\n        i0.ɵɵlistener(\"ngModelChange\", function AddComponent_Template_input_ngModelChange_10_listener($event) {\n          return ctx.searchKey = $event;\n        });\n        i0.ɵɵpipe(11, \"translate\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(12, \"button\", 8);\n        i0.ɵɵlistener(\"click\", function AddComponent_Template_button_click_12_listener() {\n          return ctx.search();\n        });\n        i0.ɵɵtext(13);\n        i0.ɵɵpipe(14, \"translate\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(15, AddComponent_div_15_Template, 3, 3, \"div\", 9);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(16, \"div\", 10);\n        i0.ɵɵelementStart(17, \"div\", 11);\n        i0.ɵɵtemplate(18, AddComponent_span_18_Template, 2, 1, \"span\", 12);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(19, AddComponent_div_19_Template, 7, 4, \"div\", 13);\n        i0.ɵɵpipe(20, \"async\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(4);\n        i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(5, 7, \"catalogue.ADD_ART\"), \" \");\n        i0.ɵɵadvance(6);\n        i0.ɵɵpropertyInterpolate(\"placeholder\", i0.ɵɵpipeBind1(11, 9, \"catalogue.ENTER_ART_NAME\"));\n        i0.ɵɵproperty(\"ngModel\", ctx.searchKey);\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(14, 11, \"catalogue.SEARCH\"), \" \");\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", ctx.searchHasError);\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngForOf\", ctx.lastThreeSearches);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(20, 13, ctx.selectedArt$));\n      }\n    },\n    directives: [i3.DefaultValueAccessor, i3.NgControlStatus, i3.NgModel, i5.NgIf, i5.NgForOf, i3.ɵNgNoValidate, i3.NgControlStatusGroup, i3.FormGroupDirective, i3.FormControlName, i6.CharacterDirective, i3.RadioControlValueAccessor],\n    pipes: [i7.TranslatePipe, i5.AsyncPipe],\n    styles: [\".middle[_ngcontent-%COMP%]{background-image:url(/assets/images/contentimage.jpg);background-size:cover}main[_ngcontent-%COMP%]{height:calc(100% - 60px)}.search-form[_ngcontent-%COMP%]{max-width:400px}.alert[_ngcontent-%COMP%]{margin-bottom:0!important}.badge[_ngcontent-%COMP%]{cursor:pointer}.poster[_ngcontent-%COMP%]{width:300px}\"]\n  });\n  return AddComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}